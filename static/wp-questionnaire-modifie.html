<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulaire Projet en Ligne</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="checkbox-group-styles.css">
  <script src="facteurs-locaux-implementation.js" defer></script>
  <style>
    /* Styles pour le chat d'aide */
    .help-guide {
      position: fixed;
      left: 0;
      top: auto;
      bottom: 0;
      width: 350px;
      max-width: 90%;
      background-color: white;
      border-radius: 0 5px 0 0;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      transition: transform 0.3s ease;
      transform: translateX(0);
    }
    
    .help-guide-hidden {
      transform: translateX(-100%);
    }
    
    .help-guide-header {
      background-color: #1EB4B6;
      color: white;
      padding: 10px 15px;
      border-radius: 0 5px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .help-guide-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 500;
    }
    
    .help-guide-close {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      padding: 0 5px;
    }
    
    .help-guide-content {
      padding: 15px;
      overflow-y: auto;
      max-height: 400px;
    }
    
    .help-guide-content h4 {
      color: #1EB4B6;
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 14px;
    }
    
    .help-guide-content p, .help-guide-content ul {
      font-size: 13px;
      line-height: 1.5;
      color: #333;
      margin-bottom: 15px;
    }
    
    .help-guide-content ul {
      padding-left: 20px;
    }
    
    .help-guide-content li {
      margin-bottom: 5px;
    }
    
    .help-guide-content li strong {
      font-weight: bold;
    }
    
    .help-toggle {
      position: fixed;
      left: 0;
      top: auto;
      bottom: 20px;
      transform: none;
      background-color: #1EB4B6;
      color: white;
      border: none;
      border-radius: 0 5px 5px 0;
      padding: 10px 15px;
      cursor: pointer;
      z-index: 999;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
    }
    
    .help-toggle span {
      margin-top: 5px;
    }
    
    .help-highlight {
      background-color: #f8f9fa;
      border-left: 3px solid #1EB4B6;
      padding: 8px 10px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <!-- Chat d'aide -->
  <div class="help-guide help-guide-hidden" id="help-guide">
    <div class="help-guide-header">
      <h3 id="help-guide-title">Guide d'utilisation</h3>
      <button class="help-guide-close" id="help-guide-close">×</button>
    </div>
    <div class="help-guide-content" id="help-guide-text">
      <p>Bienvenue dans le formulaire d'analyse immobilière. Remplissez les champs pour obtenir un rapport personnalisé.</p>
      <p>Cliquez sur les différents champs du formulaire pour voir des explications détaillées.</p>
    </div>
  </div>
  
  <button class="help-toggle" id="help-toggle">
    <i class="fas fa-question-circle"></i>
    <span>Aide</span>
  </button>

  <div class="steps-container">
    <div class="step">
      <div class="circle">
        <span class="number">1</span>
      </div>
      <div class="text">
        <h3>Analyse IA</h3>
        <p>L'intelligence artificielle analyse vos données en temps réel pour un résultat personnalisé.</p>
      </div>
    </div>
    <div class="line"></div>
    <div class="step">
      <div class="circle">
        <span class="number">2</span>
      </div>
      <div class="text">
        <h3>Rapport IA</h3>
        <p>Recevez un rapport détaillé avec des recommandations adaptées à vos besoins.</p>
      </div>
    </div>
    <div class="line"></div>
    <div class="step">
      <div class="circle">
        <span class="number">3</span>
      </div>
      <div class="text">
        <h3>Génération IA</h3>
        <p>Notre IA génère des solutions clé en main pour votre projet.</p>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const steps = document.querySelectorAll(".step");
      steps.forEach((step, index) => {
        setTimeout(() => {
          step.classList.add("visible");
        }, index * 500);
      });
    });
  </script>

  <div class="container">
    <div id="form-container">
      <div class="title-box">PROJET EN LIGNE</div>
      <p>
        Pour commencer l'analyse de vos clients, remplissez le questionnaire en ligne en veillant à indiquer uniquement les unités (par exemple, saisissez 100 plutôt que 100 € ou 20 plutôt que 20 m²). Fournissez des informations détaillées pour garantir une analyse optimale.
      </p>
      <p>
        Une fois le formulaire complété, cliquez sur « Envoyer » pour générer le rapport. En fonction de la vitesse de votre connexion, le fichier sera automatiquement téléchargé sur votre ordinateur ou smartphone au format PDF. Lorsque le curseur atteint 90 %, veuillez patienter entre 2 et 5 minutes pour finaliser le téléchargement de votre rapport.
      </p>

      <form id="mon-formulaire-unique">
        <!-- Informations personnelles -->
        <fieldset>
          <legend>Informations personnelles</legend>
          <label for="analysis-date">Date / Heure de l'analyse</label>
          <input type="datetime-local" id="analysis-date" name="analysis-date" required>

          <label for="civilite">Civilité</label>
          <select id="civilite" name="civilite" required>
            <option value="">-- Sélectionnez --</option>
            <option value="monsieur">Monsieur</option>
            <option value="madame">Madame</option>
          </select>

          <label for="name">Nom Prénom</label>
          <input type="text" id="name" name="name" required>

          <label for="address-line1">Adresse Ligne 1</label>
          <input type="text" id="address-line1" name="address-line1" required>

          <label for="address-line2">Adresse Ligne 2</label>
          <input type="text" id="address-line2" name="address-line2">

          <label for="city">Ville</label>
          <input type="text" id="city" name="city" required>

          <label for="region">État / Province / Région</label>
          <input type="text" id="region" name="region" required>

          <label for="postal-code">Code Postal</label>
          <input type="text" id="postal-code" name="postal-code" required>

          <label for="country">Pays</label>
          <input type="text" id="country" name="country" required>

          <label for="phone">Téléphone</label>
          <input type="tel" id="phone" name="phone" required>

          <label for="agency-email">E-mail de votre Agence</label>
          <input type="email" id="agency-email" name="agency-email" required>
        </fieldset>

        <!-- Questions générales -->
        <fieldset>
          <legend>Questions générales</legend>
          <label for="investment-reason">Quelle est pour vous la principale raison qui vous motive pour réaliser cet investissement ?</label>
          <textarea id="investment-reason" name="investment-reason" rows="4" required></textarea>

          <label>Avez-vous déjà identifié des biens qui pourraient correspondre à votre recherche ?</label>
          <select name="identified-property" required>
            <option value="oui">Oui</option>
            <option value="non">Non</option>
          </select>

          <label>Êtes-vous engagé par un mandat ou une exclusivité auprès d'un professionnel pour cette recherche ?</label>
          <select name="exclusive-mandate" required>
            <option value="oui">Oui</option>
            <option value="non">Non</option>
          </select>

          <label>Avez-vous déjà réalisé une analyse précise sur le bien-fondé de votre projet d'investissement ?</label>
          <select name="analysis-done" required>
            <option value="oui">Oui</option>
            <option value="non">Non</option>
          </select>

          <label for="investment-objective-time">Avez-vous un objectif dans le temps pour réaliser cet investissement ?</label>
          <input type="text" id="investment-objective-time" name="investment-objective-time" required>

          <label for="risk-tolerance">Quel est votre niveau de tolérance au risque ? (de 1 à 10)</label>
          <input type="range" id="risk-tolerance" name="risk-tolerance" min="1" max="10" value="5">
          <div id="risk-tolerance-value">Valeur sélectionnée : <span>5</span></div>
        </fieldset>

        <!-- Secteur d'investissement -->
        <fieldset>
          <legend>Secteur d'investissement</legend>
          <label for="investment-sector">Dans quel secteur avez-vous ce projet d'investissement ?</label>
          <!-- Seul le secteur IMMOBILIER est conservé -->
          <select id="investment-sector" name="investment-sector" required>
            <option value="">Sélectionnez un secteur</option>
            <option value="IMMOBILIER">IMMOBILIER</option>
          </select>
        </fieldset>

        <!-- Questions dynamiques (UNIQUEMENT IMMOBILIER) -->
        <div id="sector-questions"></div>

        <!-- Bouton d'envoi -->
        <button type="submit">Envoyer et Générer</button>
      </form>

      <div id="response"></div>
      <div id="progress-container" style="display: none;">
        <div class="progress-bar">
          <div id="progress-bar" class="progress"></div>
        </div>
        <p id="progress-text">Génération du rapport en cours...</p>
      </div>
    </div>
  </div>

  <script>
    // NOUVEAU: Code pour le chat d'aide
    const helpGuide = document.getElementById('help-guide');
    const helpToggle = document.getElementById('help-toggle');
    const helpGuideClose = document.getElementById('help-guide-close');
    const helpGuideTitle = document.getElementById('help-guide-title');
    const helpGuideText = document.getElementById('help-guide-text');

    // Ouvrir/fermer le panneau d'aide
    helpToggle.addEventListener('click', function() {
      helpGuide.classList.remove('help-guide-hidden');
      helpToggle.style.display = 'none';
    });

    helpGuideClose.addEventListener('click', function() {
      helpGuide.classList.add('help-guide-hidden');
      helpToggle.style.display = 'flex';
    });

    // Guide d'aide contextuel pour les champs importants
    function updateHelpGuide(fieldName, fieldLabel) {
      let title = 'Aide pour la saisie';
      let text = '';

      // Pour les questions spécifiques
      switch(fieldName) {
        case 'analysis-date':
          title = 'Date et heure de l\'analyse';
          text = `
            <p>Sélectionnez la date et l'heure actuelles pour cette analyse.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Utilisez le sélecteur de date et d'heure pour indiquer le moment où vous réalisez cette analyse.
            </div>
            <p>Cette information servira de référence temporelle pour votre rapport.</p>
          `;
          break;

        case 'name':
          title = 'Nom et prénom';
          text = `
            <p>Indiquez votre nom complet pour personnaliser le rapport.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Écrivez votre prénom suivi de votre nom de famille.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Jean Dupont</li>
              <li>Marie Martin</li>
            </ul>
          `;
          break;

        case 'address-line1':
        case 'address-line2':
          title = 'Adresse';
          text = `
            <p>Indiquez votre adresse postale complète.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Saisissez le numéro et le nom de la rue sur la première ligne, puis les compléments éventuels sur la seconde ligne.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Ligne 1: 25 Avenue Victor Hugo</li>
              <li>Ligne 2: Appartement 4B (si applicable)</li>
            </ul>
          `;
          break;

        case 'city':
          title = 'Ville';
          text = `
            <p>Indiquez le nom de votre ville de résidence.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Écrivez le nom complet de la ville sans abréviations.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Nice</li>
              <li>Paris</li>
              <li>Lyon</li>
            </ul>
          `;
          break;

        case 'region':
          title = 'État / Province / Région';
          text = `
            <p>Indiquez votre région administrative.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Écrivez le nom complet de votre région ou département.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Provence-Alpes-Côte d'Azur</li>
              <li>Île-de-France</li>
              <li>Alpes-Maritimes</li>
            </ul>
          `;
          break;

        case 'postal-code':
          title = 'Code postal';
          text = `
            <p>Indiquez votre code postal.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Entrez les 5 chiffres de votre code postal sans espaces.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>06000</li>
              <li>75001</li>
            </ul>
          `;
          break;

        case 'country':
          title = 'Pays';
          text = `
            <p>Indiquez votre pays de résidence.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Écrivez le nom complet du pays.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>France</li>
              <li>Belgique</li>
              <li>Suisse</li>
            </ul>
          `;
          break;

        case 'phone':
          title = 'Téléphone';
          text = `
            <p>Indiquez votre numéro de téléphone de contact.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Entrez votre numéro au format international ou national.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>+33612345678</li>
              <li>06 12 34 56 78</li>
            </ul>
          `;
          break;

        case 'agency-email':
          title = 'E-mail de votre Agence';
          text = `
            <p>Indiquez l'adresse e-mail de votre agence immobilière si vous travaillez avec une agence.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Entrez l'adresse e-mail complète.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>contact@agence-immobiliere.com</li>
              <li>votre-agent@agence.fr</li>
            </ul>
            <p>Si vous n'avez pas d'agence, vous pouvez indiquer votre propre adresse e-mail.</p>
          `;
          break;

        case 'investment-reason':
          title = 'Raison de votre investissement';
          text = `
            <p>Expliquez pourquoi vous souhaitez réaliser cet investissement immobilier.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Décrivez votre motivation, vos objectifs à long terme, et ce que vous espérez en retirer. Soyez précis et détaillé.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Préparer ma retraite avec un revenu locatif mensuel de 1000€</li>
              <li>Constituer un patrimoine pour mes enfants en vue de leur études supérieures</li>
              <li>Diversifier mes investissements face à l'instabilité des marchés financiers</li>
              <li>Réduire mes impôts tout en investissant dans la pierre</li>
            </ul>
            <p>Plus vos motivations sont claires, plus nous pourrons adapter nos recommandations.</p>
          `;
          break;

        case 'identified-property':
          title = 'Biens identifiés';
          text = `
            <p>Indiquez si vous avez déjà identifié des biens qui pourraient correspondre à votre recherche.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "Oui" si vous avez déjà repéré des biens, "Non" dans le cas contraire.
            </div>
            <p>Si vous avez répondu "Oui", le rapport pourra prendre en compte des comparaisons avec des biens similaires.</p>
          `;
          break;

        case 'exclusive-mandate':
          title = 'Mandat ou exclusivité';
          text = `
            <p>Indiquez si vous êtes engagé par un mandat ou une exclusivité avec un professionnel.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "Oui" si vous avez signé un mandat exclusif avec une agence, "Non" dans le cas contraire.
            </div>
            <p>Cette information est importante pour comprendre où vous en êtes dans votre recherche.</p>
          `;
          break;

        case 'analysis-done':
          title = 'Analyse préalable';
          text = `
            <p>Indiquez si vous avez déjà réalisé une analyse précise sur le bien-fondé de votre projet.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "Oui" si vous avez déjà fait analyser votre projet, "Non" si c'est la première fois.
            </div>
            <p>Cela nous permet de savoir si vous disposez déjà d'informations sur la viabilité de votre projet.</p>
          `;
          break;

        case 'investment-objective-time':
          title = 'Objectif de temps pour votre investissement';
          text = `
            <p>Indiquez votre horizon temporel pour réaliser cet investissement.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Précisez exactement le délai dans lequel vous souhaitez acquérir ce bien.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Dans les 3 prochains mois maximum</li>
              <li>Avant la fin de l'année 2023</li>
              <li>D'ici 6 mois, pas au-delà</li>
              <li>Immédiatement, dès qu'une opportunité se présente</li>
            </ul>
            <p>La précision de cette information nous aide à adapter l'urgence des recommandations.</p>
          `;
          break;

        case 'risk-tolerance':
          title = 'Tolérance au risque';
          text = `
            <p>Indiquez votre niveau de tolérance au risque sur une échelle de 1 à 10.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Déplacez le curseur vers la gauche (1-3) pour une faible tolérance, au milieu (4-7) pour une tolérance moyenne, ou vers la droite (8-10) pour une haute tolérance.
            </div>
            <p><strong>Guide :</strong></p>
            <ul>
              <li><strong>1-3</strong> : Vous préférez la sécurité, même avec un rendement plus faible</li>
              <li><strong>4-7</strong> : Vous acceptez un risque modéré pour un meilleur rendement</li>
              <li><strong>8-10</strong> : Vous êtes prêt à prendre des risques importants pour maximiser le rendement</li>
            </ul>
          `;
          break;

        case 'investment-sector':
          title = 'Secteur d\'investissement';
          text = `
            <p>Sélectionnez le secteur dans lequel vous souhaitez investir.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "IMMOBILIER" pour cette analyse (c'est actuellement la seule option disponible).
            </div>
            <p>Cette sélection déterminera les questions spécifiques qui vous seront posées ensuite.</p>
          `;
          break;

        case 'type-bien':
          title = 'Type de bien (neuf ou ancien)';
          text = `
            <p>Indiquez si vous préférez un bien neuf ou ancien.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "Neuf" pour un bien récemment construit ou en VEFA, ou "Ancien" pour un bien existant.
            </div>
            <p><strong>Considérations :</strong></p>
            <ul>
              <li><strong>Neuf</strong> : Garanties constructeur, normes récentes, pas de travaux immédiats</li>
              <li><strong>Ancien</strong> : Souvent moins cher au m², potentiel de plus-value après rénovation</li>
            </ul>
          `;
          break;

        case 'type-bien-recherche':
          title = 'Type de bien recherché';
          text = `
            <p>Sélectionnez le type de bien immobilier que vous recherchez.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Choisissez parmi les options proposées celle qui correspond le mieux à votre recherche.
            </div>
            <p><strong>Options :</strong></p>
            <ul>
              <li><strong>Appartement</strong> : Logement dans un immeuble collectif</li>
              <li><strong>Terrain</strong> : Parcelle constructible sans bâtiment</li>
              <li><strong>Maison</strong> : Logement individuel standard</li>
              <li><strong>Villa</strong> : Maison haut de gamme avec prestations supérieures</li>
            </ul>
          `;
          break;

        case 'architecture-exterieur':
          title = 'Architecture extérieure';
          text = `
            <p>Pour une maison ou villa, indiquez le style architectural extérieur que vous préférez.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez le style qui correspond le mieux à vos goûts esthétiques.
            </div>
            <p><strong>Options :</strong></p>
            <ul>
              <li><strong>Traditionnelle</strong> : Style classique régional</li>
              <li><strong>Provençale</strong> : Typique du sud de la France (tuiles romaines, enduit ocre...)</li>
              <li><strong>Contemporaine</strong> : Design moderne avec lignes épurées</li>
              <li><strong>Industrielle</strong> : Inspirée des lofts, avec métal, briques apparentes</li>
            </ul>
          `;
          break;

        case 'usage-bien':
          title = 'Usage du bien';
          text = `
            <p>Indiquez pourquoi vous recherchez ce bien.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "Pour y vivre" si vous comptez l'occuper vous-même, ou "Investissement" s'il s'agit d'un placement locatif.
            </div>
            <p>Cette information est cruciale car elle oriente complètement l'analyse de rentabilité et les recommandations.</p>
          `;
          break;

        case 'elements-eviter':
          title = 'Éléments à éviter';
          text = `
            <p>Indiquez les éléments que vous souhaitez absolument éviter dans votre bien.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez l'option qui correspond à votre préoccupation principale.
            </div>
            <p><strong>Options :</strong></p>
            <ul>
              <li><strong>Oui, le bruit</strong> : Vous êtes particulièrement sensible aux nuisances sonores</li>
              <li><strong>Oui, manque de luminosité</strong> : Vous recherchez un bien lumineux</li>
              <li><strong>Non</strong> : Vous n'avez pas de préoccupation particulière</li>
            </ul>
          `;
          break;

        case 'reactivite':
          title = 'Réactivité pour l\'achat';
          text = `
            <p>Indiquez votre niveau de réactivité si un bien idéal est trouvé.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Évaluez honnêtement votre capacité à prendre une décision rapidement.
            </div>
            <p><strong>Options :</strong></p>
            <ul>
              <li><strong>Oui, assez réactif</strong> : Vous êtes prêt à faire une offre immédiatement</li>
              <li><strong>Oui, avec un peu de temps</strong> : Vous avez besoin de quelques jours pour réfléchir</li>
              <li><strong>Non, il me faut plus de temps</strong> : Vous préférez prendre votre temps pour décider</li>
            </ul>
          `;
          break;

        case 'architecture':
          title = 'Style d\'intérieur recherché';
          text = `
            <p>Décrivez précisément le style d'intérieur que vous préférez pour votre bien.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Détaillez les styles, matériaux, ambiances ou caractéristiques spécifiques que vous recherchez.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Style contemporain avec espaces ouverts, cuisine américaine et matériaux modernes comme le verre et l'acier</li>
              <li>Intérieur chaleureux avec matériaux naturels (parquet massif chêne clair, pierres apparentes), poutres au plafond</li>
              <li>Aménagement minimaliste avec grandes baies vitrées, murs blancs et rangements intégrés</li>
              <li>Style haussmannien avec moulures, cheminées, parquet en point de Hongrie et hauts plafonds</li>
            </ul>
            <p>Plus votre description est précise, plus nous pourrons orienter les recommandations vers des biens qui vous plairont.</p>
          `;
          break;

        case 'secteur':
          title = 'Quel secteur pour votre bien ?';
          text = `
            <p>Dans ce champ, veuillez indiquer la localisation géographique précise où vous souhaitez investir.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Vous pouvez indiquer le nom de la ville, du quartier, de l'arrondissement ou même une adresse précise. Soyez aussi spécifique que possible.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Nice centre ville - Quartier Musiciens</li>
              <li>Lyon 6ème arrondissement - Secteur Brotteaux</li>
              <li>Banlieue ouest de Paris - Rueil-Malmaison</li>
              <li>Côte d'Azur, région de Cannes - Secteur La Californie</li>
              <li>5 Avenue Jean Médecin, 06000 Nice et ses environs dans un rayon de 500m</li>
              <li>Quartier Libération à Nice, à proximité immédiate de la place du Général de Gaulle</li>
            </ul>
            <p>Plus votre indication est précise, plus notre analyse sera pertinente et détaillée, avec des données exactes sur les prix, les tendances et les perspectives d'évolution.</p>
          `;
          break;

        case 'zone-preferentielle':
          title = 'Zone préférentielle prioritaire';
          text = `
            <p>Ce champ vous permet d'affiner votre recherche en spécifiant des zones très précises qui sont prioritaires pour vous.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Mentionnez des rues spécifiques, des micro-quartiers, des points d'intérêt ou des zones très précises dans le secteur indiqué précédemment.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Proximité immédiate du parc Victor Hugo (moins de 200m)</li>
              <li>À moins de 500m de la gare centrale, côté est de préférence</li>
              <li>Secteur des rues piétonnes du centre-ville, en particulier rue Masséna et rue de France</li>
              <li>Quartier des affaires, près des bureaux de Sophia Antipolis, secteur des Templiers</li>
              <li>Autour de la place Garibaldi, prioritairement rue Bonaparte et rue Cassini</li>
              <li>Entre l'avenue Jean Médecin et le boulevard Victor Hugo, au nord de la place Masséna</li>
            </ul>
            <p>Ces informations précises nous permettront de cibler exactement les secteurs qui correspondent à vos priorités et d'analyser en détail les opportunités dans ces micro-zones.</p>
          `;
          break;

        case 'superficie-habitable':
          title = 'Superficie habitable';
          text = `
            <p>Indiquez précisément la superficie habitable que vous recherchez pour votre bien.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Entrez uniquement le nombre en m² (sans l'unité). Il s'agit de la surface habitable, hors balcons, terrasses et annexes.
            </div>
            <p><strong>Exemples :</strong></p>
            <ul>
              <li>Pour un appartement de 75 m², saisissez : 75</li>
              <li>Pour une maison de 120 m², saisissez : 120</li>
            </ul>
            <p>Cette information est essentielle pour estimer correctement le prix du bien et sa valeur sur le marché. Elle permet également de calculer le prix au m² et de le comparer aux références du marché local.</p>
          `;
          break;

        case 'localFactors[]':
          title = 'Facteurs locaux importants';
          text = `
            <p>Ces options vous permettent d'indiquer les facteurs locaux qui sont particulièrement importants pour votre investissement.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Cochez uniquement les facteurs qui sont vraiment importants pour vous. Ces facteurs feront l'objet d'une analyse détaillée dans votre rapport.
            </div>
            <p><strong>Détails des facteurs (cochez seulement ceux qui sont essentiels) :</strong></p>
            <ul>
              <li><strong>Transports en commun</strong> : Analyse extrêmement détaillée de toutes les lignes de métro, bus, tramway avec leurs numéros exacts, les stations les plus proches, les distances précises en mètres et minutes de marche, les fréquences de passage.</li>
              <li><strong>Proximité écoles</strong> : Inventaire complet de tous les établissements scolaires (crèches, maternelles, primaires, collèges, lycées, universités) avec leurs noms exacts, types, distances précises et réputations.</li>
              <li><strong>Commerces</strong> : Liste détaillée de tous les commerces essentiels (supermarchés avec leurs enseignes exactes, boulangeries, pharmacies, restaurants) avec distances précises et comparaison avec d'autres quartiers.</li>
              <li><strong>Sécurité</strong> : Données chiffrées sur la criminalité, comparaison avec la moyenne de la ville, présence policière, et évolution sur les dernières années.</li>
              <li><strong>Projets urbains</strong> : Détails de tous les projets d'aménagement en cours ou prévus avec dates, budgets et impact sur la valeur immobilière.</li>
              <li><strong>Bassin d'emploi</strong> : Analyse du dynamisme économique local avec tous les employeurs majeurs, secteurs d'activité dominants et perspectives d'évolution.</li>
            </ul>
            <p>Pour chaque facteur sélectionné, notre IA réalisera une analyse extrêmement détaillée et factuelle. <strong>Ne sélectionnez que ceux qui sont vraiment importants pour vous afin d'obtenir des analyses plus approfondies sur ces aspects spécifiques.</strong></p>
          `;
          break;

        case 'nombre-chambres':
          title = 'Nombre de chambres';
          text = `
            <p>Indiquez le nombre idéal de chambres pour votre bien.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez le nombre exact de chambres que vous souhaitez.
            </div>
            <p>Cette information est essentielle pour déterminer la taille du bien et son adaptation à vos besoins.</p>
          `;
          break;

        case 'autres-pieces[]':
          title = 'Autres pièces souhaitées';
          text = `
            <p>Cochez toutes les pièces supplémentaires que vous souhaitez dans votre bien.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez toutes les options qui correspondent à vos besoins. Ne cochez que les pièces vraiment importantes pour vous.
            </div>
            <p>Ces informations nous permettront de cibler des biens avec ces caractéristiques spécifiques.</p>
          `;
          break;

        case 'nombre-salles-bain':
          title = 'Nombre de salles de bain';
          text = `
            <p>Indiquez le nombre de salles de bain souhaité.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez le nombre exact de salles de bain/salles d'eau que vous désirez.
            </div>
            <p>Ce critère est important pour le confort quotidien et influence significativement le prix du bien.</p>
          `;
          break;

        case 'type-cuisine':
          title = 'Type de cuisine';
          text = `
            <p>Indiquez si vous préférez une cuisine fermée ou ouverte.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Choisissez "Ouverte" pour une cuisine américaine intégrée au séjour, ou "Fermée" pour une pièce séparée.
            </div>
            <p>Ce choix affecte l'organisation de l'espace de vie et l'ambiance générale du bien.</p>
          `;
          break;

        case 'cuisine-dinatoire':
          title = 'Cuisine dinatoire';
          text = `
            <p>Indiquez si vous souhaitez une cuisine assez grande pour y manger.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "Oui" si vous voulez pouvoir installer une table à manger dans la cuisine.
            </div>
            <p>Ce critère est important pour le mode de vie et l'organisation des repas au quotidien.</p>
          `;
          break;

        case 'places-parking':
          title = 'Nombre de places de parking';
          text = `
            <p>Indiquez le nombre de places de stationnement dont vous avez besoin.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez le nombre exact de places nécessaires pour vos véhicules.
            </div>
            <p>Dans certaines zones urbaines, les places de parking peuvent significativement augmenter la valeur du bien.</p>
          `;
          break;

        case 'parking-couvert':
          title = 'Places de parking couvertes';
          text = `
            <p>Indiquez si les places de parking doivent être couvertes.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "Oui" si vous souhaitez un garage ou des places couvertes, "Non" si un stationnement extérieur vous convient.
            </div>
            <p>Les places couvertes offrent une meilleure protection pour vos véhicules mais peuvent coûter plus cher.</p>
          `;
          break;

        case 'piscine':
          title = 'Piscine';
          text = `
            <p>Indiquez si vous souhaitez une piscine ou un terrain piscinable.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Choisissez "Oui" si c'est indispensable, "Non" si vous n'en voulez pas, ou "Ce n'est pas impératif" si c'est un bonus mais pas une nécessité.
            </div>
            <p>Une piscine ajoute une valeur significative mais représente aussi un coût d'entretien à prendre en compte.</p>
          `;
          break;

        case 'contre-travaux':
          title = 'Position sur les travaux';
          text = `
            <p>Indiquez si vous êtes contre un besoin de travaux pour que le bien corresponde à vos attentes.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "Oui" si vous préférez un bien prêt à habiter sans travaux, "Non" si vous acceptez de faire des travaux.
            </div>
            <p>Les biens nécessitant des travaux sont souvent moins chers à l'achat mais requièrent un budget supplémentaire pour les aménagements.</p>
          `;
          break;

        case 'distance-commerces':
          title = 'Distance des commerces';
          text = `
            <p>Indiquez la distance maximale souhaitée entre votre bien et les principaux commerces.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Précisez la distance exacte (en mètres ou km) ou le temps de trajet maximum acceptable.
            </div>
            <p><strong>Exemples précis :</strong></p>
            <ul>
              <li>Maximum 500 mètres à pied</li>
              <li>Moins de 1 km</li>
              <li>Maximum 10 minutes à pied</li>
              <li>Dans un rayon de 800 mètres</li>
            </ul>
            <p>La proximité des commerces est un facteur important pour la qualité de vie et la valeur locative.</p>
          `;
          break;

        case 'distance-ecoles-primaires':
          title = 'Distance des écoles primaires';
          text = `
            <p>Indiquez la distance maximale souhaitée entre votre bien et les écoles primaires.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Précisez la distance exacte (en mètres ou km) ou le temps de trajet maximum acceptable.
            </div>
            <p><strong>Exemples précis :</strong></p>
            <ul>
              <li>Maximum 400 mètres</li>
              <li>Moins de 800 mètres à pied</li>
              <li>Maximum 5 minutes à pied</li>
              <li>À distance de marche sécurisée pour un enfant</li>
            </ul>
            <p>La proximité des écoles primaires est particulièrement importante pour les familles avec jeunes enfants.</p>
          `;
          break;

        case 'distance-ecoles-secondaires':
          title = 'Distance des écoles secondaires';
          text = `
            <p>Indiquez la distance maximale souhaitée entre votre bien et les établissements secondaires.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Précisez la distance exacte (en mètres ou km) ou le temps de trajet maximum acceptable.
            </div>
            <p><strong>Exemples précis :</strong></p>
            <ul>
              <li>Maximum 1 km</li>
              <li>Moins de 15 minutes à pied</li>
              <li>Accessible en transport en commun en moins de 20 minutes</li>
              <li>Dans un rayon de 2 km maximum</li>
            </ul>
            <p>La proximité des collèges et lycées est importante pour les familles avec adolescents.</p>
          `;
          break;

        case 'distance-lieu-travail':
          title = 'Distance du lieu de travail';
          text = `
            <p>Indiquez la distance maximale acceptable entre votre bien et votre lieu de travail.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Précisez la distance exacte (en km) ou le temps de trajet maximum acceptable.
            </div>
            <p><strong>Exemples précis :</strong></p>
            <ul>
              <li>Maximum 10 km</li>
              <li>Moins de 30 minutes en voiture</li>
              <li>Maximum 45 minutes en transport en commun</li>
              <li>Dans un rayon de 15 km maximum</li>
            </ul>
            <p>Le temps de trajet domicile-travail a un impact majeur sur la qualité de vie quotidienne.</p>
          `;
          break;

        case 'lieu-travail':
          title = 'Votre lieu de travail';
          text = `
            <p>Indiquez avec précision l'adresse ou la zone de votre lieu de travail.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Précisez l'adresse exacte, le quartier précis ou la zone spécifique où vous travaillez.
            </div>
            <p><strong>Exemples précis :</strong></p>
            <ul>
              <li>Centre d'affaires Sophia Antipolis - Zone des Templiers</li>
              <li>Quartier La Défense - Tour Ariane, 5 Place de la Pyramide</li>
              <li>10 Avenue de la Liberté, 06000 Nice</li>
              <li>Zone industrielle de Carros - Pôle logistique</li>
            </ul>
            <p>Cette information précise nous permettra d'analyser en détail les temps de trajet et les options de transport entre votre domicile et votre lieu de travail.</p>
          `;
          break;

        case 'budget-ideal':
          title = 'Budget idéal';
          text = `
            <p>Indiquez précisément le budget que vous souhaitez consacrer à cet investissement.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Entrez uniquement le montant en euros (sans le symbole €, sans espaces et sans virgules).
            </div>
            <p><strong>Exemples précis :</strong></p>
            <ul>
              <li>Pour un budget de 250 000 €, saisissez : 250000</li>
              <li>Pour un budget de 500 000 €, saisissez : 500000</li>
              <li>Pour un budget de 1 200 000 €, saisissez : 1200000</li>
            </ul>
            <p>Cette information est cruciale pour cibler les biens dans votre gamme de prix et évaluer la faisabilité de votre projet.</p>
          `;
          break;

        case 'marge-budget':
          title = 'Marge sur le budget';
          text = `
            <p>Indiquez si vous avez une marge de manœuvre sur votre budget pour un coup de cœur.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez le pourcentage supplémentaire que vous pourriez envisager pour un bien exceptionnel.
            </div>
            <p>Cette flexibilité peut être déterminante pour ne pas passer à côté d'une opportunité rare qui dépasse légèrement votre budget initial.</p>
          `;
          break;

        case 'besoin-financement':
          title = 'Besoin de financement';
          text = `
            <p>Indiquez si vous avez besoin de financer une partie de votre investissement.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Sélectionnez "Oui" si vous prévoyez de recourir à un prêt, "Non" si vous financez intégralement sur fonds propres.
            </div>
            <p>Cette information est essentielle pour évaluer la faisabilité financière de votre projet et calculer la rentabilité réelle de votre investissement.</p>
          `;
          break;

        case 'montant-financer':
          title = 'Montant à financer';
          text = `
            <p>Indiquez précisément le montant que vous devrez emprunter pour réaliser cet investissement.</p>
            <div class="help-highlight">
              <strong>Comment remplir :</strong> Entrez uniquement le montant en euros (sans le symbole €, sans espaces et sans virgules).
            </div>
            <p><strong>Exemples précis :</strong></p>
            <ul>
              <li>Pour un emprunt de 200 000 €, saisissez : 200000</li>
              <li>Pour un emprunt de 400 000 €, saisissez : 400000</li>
              <li>Pour un emprunt de 850 000 €, saisissez : 850000</li>
            </ul>
            <p>Ce montant nous permettra de calculer précisément les mensualités et l'impact du financement sur la rentabilité de votre investissement.</p>
          `;
          break;

        default:
          // Pour les autres champs, créer une aide générique basée sur le label
          const fieldLabelText = fieldLabel || 'ce champ';
          title = `Aide pour "${fieldLabelText}"`;
          text = `<p>Veuillez remplir ce champ avec des informations précises et détaillées pour permettre une analyse optimale.</p>
          <div class="help-highlight">
            <strong>Comment remplir :</strong> Soyez aussi spécifique que possible dans votre réponse.
          </div>`;
      }

      helpGuideTitle.textContent = title;
      helpGuideText.innerHTML = text;
      helpGuide.classList.remove('help-guide-hidden');
      helpToggle.style.display = 'none';
    }

    // Attacher des événements d'aide contextuelle aux champs importants
    document.addEventListener('focusin', function(e) {
      // Récupérer le champ actif
      const field = e.target;
      
      // Vérifier s'il s'agit d'un champ de formulaire
      if (field.tagName === 'INPUT' || field.tagName === 'TEXTAREA' || field.tagName === 'SELECT') {
        const fieldName = field.getAttribute('name');
        
        // Trouver le label correspondant
        let fieldLabel = '';
        const labelElement = document.querySelector(`label[for="${field.id}"]`);
        if (labelElement) {
          fieldLabel = labelElement.textContent;
        } else {
          // Rechercher le label précédent s'il n'y a pas d'attribut "for"
          const previousLabel = field.closest('div, p, fieldset').querySelector('label');
          if (previousLabel) {
            fieldLabel = previousLabel.textContent;
          }
        }
        
        // Mettre à jour l'aide contextuelle
        updateHelpGuide(fieldName, fieldLabel);
      }
    });

    // Gestionnaire d'événements pour les cases à cocher des facteurs locaux
    document.addEventListener('change', function(e) {
      if (e.target.name === 'localFactors[]') {
        updateHelpGuide('localFactors[]', 'Facteurs locaux importants');
      }
    });

    // Code existant pour le formulaire
    document.getElementById('investment-sector').addEventListener('change', function () {
      const sector = this.value;
      const sectorQuestions = document.getElementById('sector-questions');
      sectorQuestions.innerHTML = '';
      if (sector === 'IMMOBILIER') {
        sectorQuestions.innerHTML = `<fieldset><legend>Questions IMMOBILIER</legend>${getImmobilierQuestions()}</fieldset>`;
        
        // Réattacher les événements après insertion dynamique du contenu
        attachEventsToNewContent();
      }
    });

    // Fonction pour attacher des événements aux éléments créés dynamiquement
    function attachEventsToNewContent() {
      // Architecture extérieure pour Maison/Villa
      const typeBienSelect = document.getElementById('type-bien-recherche');
      if (typeBienSelect) {
        typeBienSelect.addEventListener('change', function() {
          const architectureContainer = document.getElementById("architecture-container");
          const architectureSelect = architectureContainer.querySelector('select[name="architecture-exterieur"]');
          if (this.value === "maison" || this.value === "villa") {
            architectureContainer.style.display = "block";
            architectureSelect.setAttribute('required', 'required');
          } else {
            architectureContainer.style.display = "none";
            architectureSelect.removeAttribute('required');
            architectureSelect.value = "";
          }
        });
      }

      // Question 31 selon la réponse à la question 30
      const besoinFinancement = document.getElementById('besoin-financement');
      if (besoinFinancement) {
        besoinFinancement.addEventListener('change', function() {
          const question31 = document.getElementById("question-31");
          const montantInput = question31.querySelector('input[name="montant-financer"]');
          if (this.value === "oui") {
            question31.style.display = "block";
            montantInput.setAttribute('required', 'required');
          } else {
            question31.style.display = "none";
            montantInput.removeAttribute('required');
            montantInput.value = "";
          }
        });
      }

      // Attacher des événements d'aide contextuelle pour les champs importants
      const secteurTextarea = document.querySelector('textarea[name="secteur"]');
      if (secteurTextarea) {
        secteurTextarea.addEventListener('focus', function() {
          updateHelpGuide('secteur', 'Dans quel secteur voyez-vous ce bien ?');
        });
      }

      const zoneTextarea = document.querySelector('textarea[name="zone-preferentielle"]');
      if (zoneTextarea) {
        zoneTextarea.addEventListener('focus', function() {
          updateHelpGuide('zone-preferentielle', 'Zone préférentielle prioritaire');
        });
      }

      // Facteurs locaux
      const factorsCheckboxes = document.querySelectorAll('input[name="localFactors[]"]:checked');
      factorsCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          updateHelpGuide('localFactors[]', 'Facteurs locaux importants');
        });
      });
    }

    // Fonction générant l'ensemble des questions IMMOBILIER
    function getImmobilierQuestions() {
      return `
        <label>1) De quel type de bien parlons-nous ? (neuf ou ancien ?)</label>
        <select name="type-bien" required>
          <option value="neuf">Neuf</option>
          <option value="ancien">Ancien</option>
        </select>

        <label>2) Quel type de bien recherchez-vous ?</label>
        <select name="type-bien-recherche" id="type-bien-recherche" required>
          <option value="">-- Sélectionnez --</option>
          <option value="appartement">Appartement</option>
          <option value="terrain">Terrain</option>
          <option value="maison">Maison</option>
          <option value="villa">Villa</option>
        </select>

        <!-- Question conditionnelle : affichage de l'architecture extérieure pour Maison/Villa -->
        <div id="architecture-container" style="display:none;">
          <label>Type d'architecture exterieur :</label>
          <select name="architecture-exterieur">
            <option value="">-- Sélectionnez --</option>
            <option value="traditionnelle">Traditionnelle</option>
            <option value="provencale">Provencale</option>
            <option value="contemporaine">Contemporaine</option>
            <option value="industrielle">Industrielle</option>
            <option value="autres">Autres</option>
          </select>
        </div>

        <label>3) Pourquoi recherchez-vous ce bien ? </label>
        <select name="usage-bien" required>
          <option value="">-- Sélectionnez --</option>
          <option value="pour-y-vivre">Pour y vivre</option>
          <option value="investissement">Investissement</option>
        </select>

        <label>4) Y a-t-il des éléments que vous souhaitez éviter ?</label>
        <select name="elements-eviter" required>
          <option value="">-- Sélectionnez --</option>
          <option value="bruit">Oui, le bruit</option>
          <option value="manque-luminosite">Oui, manque de luminosité</option>
          <option value="aucun">Non</option>
        </select>

        <label>5) Serez-vous réactif, si nous avons la chance de trouver le bien idéal ?</label>
        <select name="reactivite" required>
          <option value="">-- Sélectionnez --</option>
          <option value="oui-reactif">Oui, assez réactif</option>
          <option value="oui-temps">Oui, avec un peu de temps</option>
          <option value="non">Non, il me faut plus de temps</option>
        </select>

        <label>6) Quel style d'intérieur recherchez-vous ?</label>
        <textarea name="architecture" rows="4" required></textarea>

        <label>7) Dans quel secteur voyez-vous ce bien ?</label>
        <textarea name="secteur" rows="4" required></textarea>

        <label>8) Avez-vous une zone préférentielle plus précise, prioritaire ?</label>
        <textarea name="zone-preferentielle" rows="4" required></textarea>

        <label>10) Quelle superficie habitable recherchez-vous (en m²) ?</label>
        <input type="number" name="superficie-habitable" required>

        <label>11) Quelle superficie minimale recherchez-vous pour le salon (en m²) ?</label>
        <input type="number" name="superficie-salon" required>

        <label>12) Dans l'idéal, combien de chambres souhaitez-vous ?</label>
        <select name="nombre-chambres" required>
          <option value="">-- Sélectionnez --</option>
          <option value="1">1 chambre</option>
          <option value="2">2 chambres</option>
          <option value="3">3 chambres</option>
          <option value="4">4 chambres</option>
          <option value="5">5 chambres</option>
          <option value="6">6 chambres</option>
          <option value="7">7 chambres</option>
          <option value="8">8 chambres</option>
        </select>

        <label>13) Souhaitez-vous d'autres pièces pour d'autres fonctions ?</label>
        <p>
          <label><input type="checkbox" name="autres-pieces[]" value="bureau"> Bureau</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="buanderie"> Buanderie</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="dressing"> Dressing</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="cellier"> Cellier</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="garage"> Garage</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="cave"> Cave</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="veranda"> Véranda</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="loggia"> Loggia</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="terrasse"> Terrasse</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="balcon"> Balcon</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="salle-sport"> Salle de sport</label><br>
          <label><input type="checkbox" name="autres-pieces[]" value="non"> Non</label>
        </p>

        <label>14) Combien de salles de bain ?</label>
        <select name="nombre-salles-bain" required>
          <option value="">-- Sélectionnez --</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>

        <label>15) Quel type de cuisine préférez-vous ?</label>
        <select name="type-cuisine" required>
          <option value="fermee">Fermée</option>
          <option value="ouverte">Ouverte</option>
        </select>

        <label>16) Une cuisine dinatoire est-elle souhaitée ?</label>
        <select name="cuisine-dinatoire" required>
          <option value="oui">Oui</option>
          <option value="non">Non</option>
        </select>

        <label>17) Nombre de places de parking ?</label>
        <select name="places-parking" required>
          <option value="">-- Sélectionnez --</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>

        <label>18) Les places doivent-elles être couvertes ?</label>
        <select name="parking-couvert" required>
          <option value="oui">Oui</option>
          <option value="non">Non</option>
        </select>

        <label>19) Superficie du terrain souhaité (en m²) ?</label>
        <input type="number" name="superficie-terrain" required>

        <label>20) Souhaitez-vous une piscine ou que le terrain soit piscinable ?</label>
        <select name="piscine" required>
          <option value="oui">Oui</option>
          <option value="non">Non</option>
          <option value="non-imperatif">Ce n'est pas impératif</option>
        </select>

        <label>21) Êtes-vous contre un besoin de travaux pour que cette acquisition corresponde à vos attentes ?</label>
        <select name="contre-travaux" required>
          <option value="oui">Oui</option>
          <option value="non">Non</option>
        </select>

        <label>23) Distance maximale souhaitée des principaux commerces ?</label>
        <input type="text" name="distance-commerces" required>

        <label>24) Distance maximale souhaitée des écoles primaires ?</label>
        <input type="text" name="distance-ecoles-primaires" required>

        <label>25) Distance maximale souhaitée des écoles secondaires ?</label>
        <input type="text" name="distance-ecoles-secondaires" required>

        <label>26) Distance maximale souhaitée de votre lieu de travail ?</label>
        <input type="text" name="distance-lieu-travail" required>

        <label>27) Quel est votre lieu de travail ?</label>
        <textarea name="lieu-travail" rows="4"></textarea>

        <label>28) Quel est votre budget idéal ?</label>
        <input type="number" name="budget-ideal" required>

        <label>29) Avez-vous une marge sur ce budget, pour un coup de cœur ? Si oui, de quel pourcentage ?</label>
        <select name="marge-budget" required>
          <option value="">-- Sélectionnez --</option>
          <option value="non">Non</option>
          <option value="5">Oui, 5%</option>
          <option value="10">Oui, 10%</option>
          <option value="15">Oui, 15%</option>
          <option value="20">Oui, 20%</option>
          <option value="25plus">Oui, plus de 25%</option>
        </select>

        <label>30) Avez-vous besoin de financer une partie de votre investissement ?</label>
        <select name="besoin-financement" id="besoin-financement" required>
          <option value="">-- Sélectionnez --</option>
          <option value="oui">Oui</option>
          <option value="non">Non</option>
        </select>

        <!-- Question 31 cachée par défaut et affichée seulement si "oui" est sélectionné à la question 30 -->
        <div id="question-31" style="display:none;">
          <label>31) Quel montant pensez-vous devoir financer ?</label>
          <input type="number" name="montant-financer">
        </div>

        <!-- Nouvelle section : Facteurs locaux importants -->
        <label>32) Facteurs locaux importants</label>
        <div class="checkbox-group">
          <label><input type="checkbox" name="localFactors[]" value="transport"> Transports en commun</label><br>
          <label><input type="checkbox" name="localFactors[]" value="schools"> Proximité écoles</label><br>
          <label><input type="checkbox" name="localFactors[]" value="shops"> Commerces</label><br>
          <label><input type="checkbox" name="localFactors[]" value="security"> Sécurité</label><br>
          <label><input type="checkbox" name="localFactors[]" value="development"> Projets urbains</label><br>
          <label><input type="checkbox" name="localFactors[]" value="employment"> Bassin d'emploi</label>
        </div>

        <!-- Nouveau champ pour le choix de langue -->
        <label for="language">Choisissez la langue du rapport :</label>
        <select name="language" id="language" required>
          <option value="">-- Sélectionnez --</option>
          <option value="fr">Français</option>
          <option value="en">Anglais</option>
        </select>

        <p>Le questionnaire est terminé. Le formulaire sera ensuite traité par notre BOT IA P.I investment pour générer votre rapport en PDF (patientez environ 4 à 5 minutes une fois le curseur à 90%). <span style="color:red;">Il ne faut surtout pas cliquer deux fois sur le bouton "Envoyer et Générer".</span></p>
      `;
    }

    // Soumission du formulaire avec affichage d'une barre de progression et téléchargement du PDF généré
    document.getElementById('mon-formulaire-unique').addEventListener('submit', function (event) {
      event.preventDefault();
      const formData = new FormData(this);
      const formObject = Object.fromEntries(formData.entries());
      
      // Traitement spécial pour les cases à cocher (checkbox)
      const localFactors = Array.from(document.querySelectorAll('input[name="localFactors[]"]:checked')).map(input => input.value);
      const autresPieces = Array.from(document.querySelectorAll('input[name="autres-pieces[]"]:checked')).map(input => input.value);
      
      // Ajouter les tableaux aux données du formulaire
      formObject.localFactors = localFactors;
      formObject['autres-pieces'] = autresPieces;
      
      const progressContainer = document.getElementById('progress-container');
      const progressBar = document.getElementById('progress-bar');
      const progressText = document.getElementById('progress-text');

      progressContainer.style.display = 'block';
      let progress = 0;
      const interval = setInterval(() => {
        progress += 10;
        progressBar.style.width = `${progress}%`;
        progressText.textContent = `Génération du rapport en cours... ${progress}%`;
        if (progress >= 90) {
          clearInterval(interval);
        }
      }, 500);

      fetch('https://rapport-gpt1.onrender.com', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formObject)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Erreur lors de la génération du rapport');
        }
        return response.blob();
      })
      .then(blob => {
        clearInterval(interval);
        progressBar.value = 100;
        progressText.textContent = 'Génération terminée !';
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = 'rapport_analyse.pdf';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);

        // Appel AJAX pour incrémenter le compteur de rapports
        fetch('/wp-admin/admin-ajax.php?action=increment_report_counter', {
          method: 'GET',
          credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
          console.log(data);
          // Vous pouvez vérifier la réponse ici si besoin
        })
        .catch(err => {
          console.error("Erreur lors de l'incrémentation du compteur:", err);
        });
        
        setTimeout(() => {
          progressContainer.style.display = 'none';
          alert('Le rapport a été généré avec succès. Le téléchargement va commencer.');
        }, 1000);
      })
      .catch(error => {
        clearInterval(interval);
        progressContainer.style.display = 'none';
        console.error('Erreur:', error);
        alert('Une erreur est survenue lors de la génération du rapport.');
      });
    });

    // Mise à jour dynamique de la valeur affichée du curseur de risque
    const riskSlider = document.getElementById('risk-tolerance');
    const riskValue = document.getElementById('risk-tolerance-value').querySelector('span');
    riskSlider.addEventListener('input', () => {
      riskValue.textContent = riskSlider.value;
    });
  </script>
</body>
</html> 

